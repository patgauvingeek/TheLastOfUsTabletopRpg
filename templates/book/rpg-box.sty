% Generic Box
\newtcolorbox{rpg-box}[2][]{
	boxrule=1pt,
	toptitle=2mm,
	bottomtitle=2mm,
	left=8pt,
	right=8pt,
	arc=0mm,
	fonttitle=\fontfamily{fosj}\selectfont\scshape\bfseries\color{black},
	fontupper=\fontfamily{lmss}\selectfont,
    title=#1,
	colback=#2,
    colframe={#2!50!black},
	colbacktitle=#2,
    opacityback=0.5
}

% Green comment box definition
\newenvironment{rpg-commentbox}[1]{
    \begin{rpg-box}[\ifthenelse{\isempty{#1}}{Note}{#1}]{commentgreen}
}{
    \end{rpg-box}
}

\newenvironment{rpg-warnbox}[1]{
    \begin{rpg-box}[\ifthenelse{\isempty{#1}}{Attention}{#1}]{commentred}
}{
    \end{rpg-box}
}

%Quelques conseils if #1 is none
\newenvironment{rpg-suggestionbox}[1]{
    \begin{rpg-box}[\ifthenelse{\isempty{#1}}{Conseils}{#1}]{commentblue}
}{
    \end{rpg-box}
}

\newtcolorbox{rpg-titlebox}[2][]{
    title=#2,
    left=1mm,
	right=1mm,
    enhanced,
    attach boxed title to top center={yshift=-0.25mm-\tcboxedtitleheight/2,yshifttext=2mm-\tcboxedtitleheight/2},
    boxed title style={
        boxrule=0.5mm,
        frame code={
            \path[tcb fill frame] ([xshift=-4mm]frame.west)
            -- (frame.north west) -- (frame.north east) -- ([xshift=4mm]frame.east)
            -- (frame.south east) -- (frame.south west) -- cycle;
        },
        interior code={
            \path[tcb fill interior] ([xshift=-2mm]interior.west)
            -- (interior.north west) -- (interior.north east)
            -- ([xshift=2mm]interior.east) -- (interior.south east) -- (interior.south west)
            -- cycle;
        }
    },
    #1
}

\newtcolorbox{rpg-paperbox}[2][]{
	enhanced,
	before skip=11pt plus 1pt,
	toptitle=3mm,
	boxsep=0.25ex,
	left=8pt,
	right=8pt,
	fonttitle=\fontfamily{fosj}\selectfont\scshape\bfseries\color{black},
	fontupper=\fontfamily{lmss}\selectfont,
	title=#2,
	arc=0mm,
	borderline north={1pt}{-0.5pt}{black},
	borderline south={1pt}{-0.5pt}{black},
	colback=monstertandark,
	colframe=monstertandark,
	colbacktitle=monstertandark,
	fuzzy shadow={0mm}{-3.5pt}{-0.5pt}{0.4mm}{black!60!white},
	overlay={
		\fill [fill=black] (frame.south west) -- ++(7pt,0) -- ++(0,-5pt) -- cycle;
		\fill [fill=black] (frame.north west) -- ++(7pt,0) -- ++(0,5pt) -- cycle;
		\fill [fill=black] (frame.north east) -- ++(-7pt,0) -- ++(0,5pt) -- cycle;
		\fill [fill=black] (frame.south east) -- ++(-7pt,0) -- ++(0,-5pt) -- cycle;
		},
	after={\vspace{10pt plus 1pt}\noindent},
	#1
}

\newcommand{\rpgsmall}[1][]{
    \color{lightgrey}{\footnotesize{#1}}}

\newcommand{\rpgsmallbox}[1][]{
    \tcbox[nobeforeafter,box align=base,size=fbox,height=0.6cm]{
        \ifthenelse{\isempty{#1}}{\hspace{0.5cm}}%empty
        {\rpgsmall{#1}}% not empty
    }
}

\newtcolorbox{rpg-quotebox}[2][]{enhanced jigsaw,frame hidden,boxrule=0pt,
	enhanced,
	toptitle=3mm,
	boxsep=0.25ex,
	left=8pt,
	right=8pt,
	colback=bgtan,
	colframe=bgtan,
	colbacktitle=bgtan,
	arc=0mm,
	fonttitle=\fontfamily{fosj}\selectfont\scshape\bfseries\color{black},
	borderline west={1pt}{-0.5pt}{titlered},
	borderline east={1pt}{-0.5pt}{titlered},
	fontupper = \fontfamily{lmss}\selectfont,
	title=#2,
	overlay={
		\foreach \n in {north east,north west,south east,south west}
		{\draw [titlered, fill=titlered] (frame.\n) circle (2pt); }; },
	after={\vspace{5pt plus 1pt}\noindent},
	#1
}

%\def\signed #1{{\leavevmode\unskip\nobreak\hfil\penalty50\hskip2em
%    \hbox{}\hfil\textit{--- #1}%
%    \parfillskip=0pt \finalhyphendemerits=0 \endgraf}
%}

\newcommand{\rpgquote}[2]{
    \begin{quotation}
        \par
        \textit{#1}
    \end{quotation}
    \begin{flushright}
        \textit{\small{#2}}
    \end{flushright}
}




%
% Old implementation using mdframed
%
%\newenvironment{commentbox}[1]
%{\fontfamily{lmss}\selectfont\begin{mdframed}[frametitle={#1},
%                                          frametitlefont=\fontfamily{fosj}\selectfont\scshape\bfseries\color{black},
%                                              linecolor=commentgreen,
%                                              backgroundcolor=commentgreen]}
%{\end{mdframed}}
